


# CHALLENGE 2:
  
## STRUCTURE  OF  STACKS BLOCKCHAIN  [WHOLE SYSTEM]: 
                       
stacks have a layered approach[pyramidal],where foundational  settlement layer[bottom  layer of pyramid] is bitcoin chain ,layers top foundational layer is where we can add smart contracts and programmability ability of stacks[stacks chain], and top most  layer of this pyramids contains   Hiro's subnets for speed and scalability.


As a part  PoX(proof of transfer )  mining process we have covered down below, a hash of each Stacks block is recorded to the OP_RETURN opcode of a Bitcoin transaction. The OP_RETURN opcode allows us to store up to 40 bytes of arbitrary data in a Bitcoin transaction.
      more details on opcode https://bitcoin.stackexchange.com/questions/29554/explanation-of-what-an-op-return-transaction-looks-like

Stacks layer has its own global ledger,miners and execution environment,To support smart contracts and to not overwhelm the Bitcoin blockchain with additional transactions.
Exact information of the architecture of  exceution layer of the stacks network[stacks core chain] ,built on top of bitcoin chain is not specified in any official docs.

All data and transactions on Stacks are automatically hashed and permanently stored on Bitcoin L1 on every Bitcoin block.  This compact storage of hashes on L1 is somewhat similar to rollups (but there are some  other differences).

Contracts on Stacks layer can read Bitcoin L1 transactions and respond to them. Assets on Stacks layer can be moved simply through Bitcoin L1 transactions.

Sidechains in Bitcoin typically have a different security budget from Bitcoin L1, typically as a subset of Bitcoin miners who participate in the sidechain (they don't follow 100% Bitcoin finality), their consensus runs on the sidechain (vs running on Bitcoin L1), and they don't publish their data/hashes on Bitcoin L1. The Stacks layer does not fit for  that definition cleanly, Given the consensus runs on Bitcoin L1, it follows Bitcoin finality, and publishes data/hashes on L1.
  
     REFERENCE:https://docs.stacks.co/stacks-101/what-is-stacks
               https://docs.stacks.co/stacks-101/bitcoin-connection

## HOW ARE  BLOCKS CONNECTED IN STACKS CHAIN:
Every block is connected to its previous block by having the parent block ID(Hash of its previous block) in its block and continues as a chain.

     REFERENCE :https://docs.stacks.co/stacks-101/network#nonces


## WHAT DOES EACH BLOCK CONTAIN IN STACKS:
     Nakamoto version[coming hard forked chain of stacks] blocks contain
                                         
                                          
   
 * version  :Version number to describe how to validate the block.-  1 byte.


* chain length: The total number of Stacks Block and Nakamoto Blocks preceding this block in this block's history.- 8 bytes, big-endian.




* burn spent: Total amount of BTC spent producing the sortition that selected the miner whose tenure produced this block.- 8 bytes, big-endian.


                    


* consensus hash: The consensus hash of the burn chain block that selected this tenure. The consensus hash uniquely identifies this tenure,       including across all Bitcoin forks. - 20 bytes.





 * parent block ID:The index block hash of the immediate parent of this block. This is the hash of the parent block's hash and consensus hash.- 32   bytes





 * transaction Merkle root: The SHA512/256 root hash of the binary Merkle tree calculated over the sequence of transactions in this block.- 32 bytes.





* state index Merkle root: The SHA512/256 root hash of the MARF once all of the contained transactions are processed.- 32 bytes.



* miner signature: Recoverable ECDSA signature from the tenure's miner.- 65 bytes.






 * stacker signature:A Schnorr signature[type of digital signature scheme] collectively generated by the set of Stackers over this block- 65 bytes.

       REFERENCE:https://docs.stacks.co/nakamoto-upgrade/what-is-the-nakamoto-release/nakamoto-in-depth/block-structure-and-validation



## LOWEST UNIT OF STACKS WHICH RECORDS STATE CHANGES ARE  :
                                
In the Stacks network,TRANSACTIONS are the lowest unit that records the  state changes in the blockchain .Transactions are the fundamental building blocks of the blockchain and represent the transfer of value or the execution of a smart contract.


 ## CONSENSUS MECHANISMS OF STACKS:

Stacks use proof of transfer (POX) consensus mechanism,which is an  extended version of proof of burning mechnaism,

* First lets see what is proof of burning is :

In pob(proof of burn)mechanism, by burning the coins, Miners reach consensus(the process in which coins are permanently removed from the network).A miner has more chance, if he burns more coins.

* Now lets see what is pox(proof of transfer)is: 
                                        
In this mechanism instead of burning ,miners transfer the coins to other participants in the network,but why? Because by  transferring coins to  specified address or set of addresses ,miners can show their commitment to network[that they are legit ],and this makes them eligible to participate in the consensus . In Stacks Miners send BTC's to specified addresses for reaching consensus.

         REFERENCE:https://docs.stacks.co/stacks-101/proof-of-transfer


## REWARDING MECHANISM:

### HOW DOES MINERS ARE CHOOSED TO MINT NEW BLOCKS(SO THAT THEY RECIEVE REWARDS):

Miners run Stacks nodes , to participate in the PoX mechanism. The node implements the PoX mechanism, which ensures proper handling and incentives through four key phases:

      Registration: miners register for a future election by sending consensus data to the network

      Commitment: registered miners transfer Bitcoin to participate in the election. Committed BTC are sent to a set participating STX token holders

      Election: a verifiable random function chooses one miner to write a new block on the Stacks blockchain

      Assembly: the elected miner writes the new block and collects rewards in form of new STX tokens

The miner who is selected to mine the next block is chosen depending on the amount of BTC the miners sent, that is, transferred or burnt.
The probability for a miner to mine the next block equals the BTC the miner sent divided by the total BTC all miners sent.


         REFERENCE:https://docs.stacks.co/stacks-101/mining#coinbase-rewards

###  COINBASE REWARDS:

Miners receive coinbase rewards for blocks they win.

The reward amounts are:

1000 STX per block are released in the first 4 years of mining

500 STX per block are released during the following 4 years

250 STX per block are released during the following 4 years

125 STX per block are released from then on indefinitely
         
         REFERENCE:https://docs.stacks.co/stacks-101/mining#coinbase-rewards

### TRANSACTION FEES:

 In stacks apart from rewards gained from minting new blocks ,Miners also receive Stacks fees for transactions mined in the blocks minted by them.

        
         REFERENCE:https://docs.stacks.co/stacks-101/mining#coinbase-rewards

## ATTACKS ON STACKS:
                 As of now no major attacks,
         
## CHAIN REORGS ON STACKS:
Stacks layer does not allow forks, so to reorganize the Stacks transactions would require successfully attacking Bitcoin with a deep reorg attack, which is extremely expensive and logistically difficult to pull off. It is worth noting that because Stacks blocks  are recorded on Bitcoin blocks, Information about them is publicly visible on the Bitcoin blockchain as they are produced, making it easy to detect attacks and reorgs and take counter measures, and making hidden block attacks (such as selfish mining) much more difficult than on Bitcoin itself. But still 51% of malicious Stacks mining power can perform a double-spend attack.

51% of malicious Bitcoin mining power can reorg the Stacks chain.

After nakamoto : If there is a Bitcoin reorg, then Stacks transactions which remain valid after the fork are re-mined in the same order they were in before. However, transactions that become invalid as a result of a Bitcoin fork are dropped. This is not a consensus-critical feature, and can be incrementally deployed in subsequent releases after the Nakamoto hard fork.
After the next upgrade, to reorg Stacks blocks/transactions the attacker will need to reorg Bitcoin L1 itself (which is very hard to do and therefore a great security property for a Bitcoin layer to have


                 REFERENCE:https://stx.is/nakamoto


## AVG  BLOCK INTERVAL  AND  CONFIRMATION TIME:
                      

### BEFORE HARD FORK:

Average confirmation time was  tens of minutes ,which will get changed into seconds after the fork,which is achieved by the increasing the rate at which blocks are produced(decreasing block intervals).At present the block intervals are ~10 minutes.
proof:https://docs.stacks.co/stacks-101/network
                                
### AFTER  HARD FORK:

After the  Nakamoto release, there will be two types of blocks at the Stacks layer:

1) FAST BLOCKS::This  will be produced every 5 seconds(120*current system) by a mechanism called BFT-style quorum signing ,by the  Stacks miners. Fast blocks will have new transactions and contract calls,and fast block N+1 can build on the state of fast block N, forming a linear sequence of fast blocks.

2) SETTLEMENT BLOCKS: This will be produced at every Bitcoin block. Settlement blocks will not have any new transactions ,but only settle the recent sequence of fast blocks on the Bitcoin chain. Miners of settlement blocks are economically rewarded to include the longest sequence of fast blocks for settlement on Bitcoin,

Hence confirmation and average block times are going to get a significant change after the fork.



        REFERENCE:https://github.com/stacks-network/stacks-core/discussions/3892


 ## DESIGN AND ARCHITECTURE OF THE VM USED IN STACKS VALIDATORS:
 No official details about architecture of the vm used in stacks validators,yet.

## GAS FESS:

yes there is a concept of gas fees in stacks network too like other networks,It is used to pay miners to compensate for the computational resources they use to validate and add transactions to the blockchain.The transaction fees on stacks were   as low as ~ 0.00018 STX which is not even 1 cent (according to 2021 reports and subject to vary for every transaction)
      
But how they are calculated ? it is generally understood that gas fees are determined by the complexity of the transaction and the network's current demand .

STX is the native cryptocurrency of the Stacks network and is used for various purposes, including paying gas fees.

## STANDARDS OF TOKENS IN STACKS:

Yes like other networks ,stacks too have standards for their tokens,

### FUNGIBLE 

The SIP-010 standard is an interface definition that allows Stacks applications and wallets to interact with fungible tokens in a standard way.This standard allows for interoperability between Stacks applications and wallets, ensuring a consistent way to interact with fungible tokens,

STX20 tokens are a new fungible token standard on the Stacks network .They are designed to be efficient and space-saving to fit into Stacks' memory limit and maintain the network's integrity.STX20 tokens are created using the STX20 protocol, a set of standards built on the Stacks blockchain.They are the equivalent of Bitcoin's BRC20 tokens on Stacks

          REFERENCE:https://gamma.io/learn/nfts/nft-launchpads/nft-standards
                                 
### NON-FUNGIBLE
 
 SIP-009 is the standard for creating NFTs on the Stacks blockchain ,It ensures that NFTs have the necessary features to be compatible with Stacks wallets and applications
         REFERENCE:https://gamma.io/learn/nfts/nft-launchpads/nft-standards

### SEMI-FUNGIBLE
 SIP-013 is a new standard for Semi-Fungible Tokens on the Stacks blockchain ,It extends and makes more efficient the uses of NFTs on the Stacks Blockchain.The SIP-013 contract defines data structures for edition tokens, artwork tokens, token balances, and token supplies.

 HOW THEY ARE DIFFERENT FROM NATIVE TOKENS (STX) --is  they are different from fungible and non-fungible tokens in terms of purpose and functionality . While fungible and non-fungible tokens are used for proving ownership, trading, gaming, and other applications, STX is used for gas fees and network participation . The token standards define the properties and functionalities of NFTs, fungible tokens, and SFTs, which are distinct from the role of STX in the network .


## POPULAR TOKENS LIKE USDC,USDT ON STACKS:
                                          
No none of the above mentioned popular tokens are available in stacks mainnet and testnet  ,As they are following ERC-20 standards[ethereum standards] and stacks has its own  SIP-009 standards.These tokens are primarily associated with the Ethereum  and polygon blockchains and do not have specific contract addresses or identifiers on the Stacks mainnet or testnets. 

           REFERENCE:https://developers.circle.com/stablecoins/docs/usdc-on-main-networks
                     https://developers.circle.com/stablecoins/docs/usdc-on-test-networks
                     https://docs.wert.io/docs/supported-coins-and-blockchains#:~:text=%7C%27USDT%27%7C%7C%27bsc%27%7C

## STACKS APPROACH TO PREVENTING REPLAY AND WITH-HOLDING ATTACKS AND NONCES IN STACK:
In stacks every account has  a nonce property that indicates the number of transactions processed for the given account. Nonces are one-time codes, starting at 0 for new accounts, and incremented by 1 on every transaction.

Nonces are added to all transactions and help identify them in order to ensure transactions are processed in order and to avoid duplicated processing.

The consensus mechanism  of stacks (pox) also ensures that transactions aren't "replayed" in two ways. 
1) First, nodes query its unspent transaction outputs (UTXOs) in order to satisfy their spending conditions in a new transaction. 
2) Second, messages sent between nodes review sequence numbers.

   REFERENCE:https://docs.stacks.co/stacks-101/network#nonces





 

## TRANSACTION LIFECYCLE ON STACKS:

1) Generate: Transactions are assembled according to the encoding specification.

2) Validate and sign: Transactions are validated[by users] to confirm they are well-formed. Required signatures are filled in.

3) Broadcast: Transactions are sent to a node via an api call or by applications

4) Register: A miner receives transactions, verifies, and adds them to the "mempool," a holding area for all the pending transactions.A transaction can have one of three states once it is registered: pending, success, or failed.

5) Process: Miners review the mempool and select transactions for the next block to be mined. Depending on the transaction type, different actions can happen during this step. For example, post-conditions could be verified for a token transfer, smart-contract defined tokens could be minted, or an attempt to call an existing smart contract method could be made.

6) Confirm: Miners successfully mine blocks with a set of transactions. The transactions inside are successfully propagated to the network.


7) Finalization on Bitcoin:Transactions are considered final when the corresponding "block commit" transaction on Bitcoin is finalized, typically after 3-6 confirmations.




    REFERENCE:https://docs.stacks.co/stacks-101/transactions


## sBTC OF STACKS:

sBTC is a decentralized pegged Bitcoin asset on the Stacks layer, pegged 1:1 to BTC, that
does not rely on centralized or pre-determined entities for its management. Rather, it is
maintained in a decentralized manner by a permissionless, open-membership group of
dynamically changing entities that can start or stop contributing to peg maintenance as they
please, but who—as a result of the design—have a clear economic incentive to properly
maintain the peg. These entities are the Stackers of the PoX consensus protocol, who lock, or
"Stack" STX and perform withdrawal signing and other consensus-critical tasks; in return, they
are rewarded in BTC proportionally to the STX they stack.

    REFERENCE:https://stx.is/nakamoto













                               



 






                                                                                                                                             






                 


                    




         

                                                               



              